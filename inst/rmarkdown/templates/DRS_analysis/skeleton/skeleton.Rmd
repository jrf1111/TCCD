---
title: 'DRS `r gsub(".*?\\/(.*?)$", "\\1", getwd())`'
author: "Analyst: Me"
date: "Analysis performed at `r Sys.time()`"
runtime: shiny
output:
  html_document:
    pandoc_args: "--dpi=200"
    fig_height: 3
    fig_width: 5
    code_folding: show
    df_print: kable
    toc: true
    toc_depth: 3
    toc_float: true
knit: (function(inputFile, encoding) { 
      rmarkdown::render(inputFile,
                        encoding=encoding, 
                        output_file=file.path(dirname(inputFile), 
                        "Write ups and reports",
                        "Analysis.html")) })
---

#### Files at: `r getwd()`
\
\


# Request Details {.tabset}
```{r request info, echo=FALSE, results='asis'}

suppressMessages(library(kableExtra))

filename = list.files("Info and notes", pattern = "Research Request from.*?eml", full.names = T)

file = readLines(filename)

start = which(file == "Record Details")+1
end = which(grepl("Follow this link", file))-1
file = file[start:end]


file = file[file!=""]
file = file[file!="Request Information"]
file = file[file!="Requester Information"]
file = file[file!="Contact Information"]

file = stringr::str_split_fixed(file, ": ", 2)
file[,1] = gsub(":", "", file[,1])
file = as.data.frame(file)
file$V2 = gsub("<mailto:.*?>", "", file$V2)



request_info = file[which(file$V1=="ID"):nrow(file), ]
request_info = request_info[request_info$V1!="Status", ]
rownames(request_info) = NULL
request_info$V2 = trimws(request_info$V2)




requester_info = file[1:which(file$V1=="Preferred Contact Method"), ]
rownames(requester_info) = NULL
requester_info$V2 = trimws(requester_info$V2)

requester_info$V2[requester_info$V1=="Phone"] = gsub("(", "", requester_info$V2[requester_info$V1=="Phone"], fixed = T)

requester_info$V2[requester_info$V1=="Phone"] = gsub(")", "-", requester_info$V2[requester_info$V1=="Phone"], fixed = T)

requester_info$V2[requester_info$V1=="Phone"] = gsub(" ", "", requester_info$V2[requester_info$V1=="Phone"], fixed = T)


```

## Request Information  

```{r, echo=FALSE, results='asis'}

kable(request_info, col.names=NULL) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  column_spec(1, bold = T)

```


## Requester Information  
```{r, echo=FALSE, results='asis'}

kable(requester_info, col.names=NULL) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  column_spec(1, bold = T)

```




```{r rename files in Write ups and reports, echo=FALSE}

files = list.files(path = "Write ups and reports",
                   pattern = "Word|Excel template", 
                   recursive = T, full.names = T)

new_name = getwd()
new_name = gsub(".*?_DRS[[:punct:]](.*?)$", "\\1", new_name)
new_name = gsub(" ", "", new_name)
new_name = paste(new_name, format(Sys.Date(), "%Y%m%d"), "JRF", sep = "-")


for(i in seq_along(files)){
  
  ext = gsub(".*?(xlsx|docx)", "\\1", files[i])
  
  file.rename(from = files[i], 
              to = file.path("Write ups and reports", paste0(new_name, ".", ext)) )
  
}




```


\
\
\
\

# DRS Review Log Info

```{r, echo=FALSE}


drs_info = data.frame(
  DRS = request_info$V2[1],
  "Date Submitted" = request_info$V2[2],
  "Date Required" = request_info$V2[3],
  Description = gsub(".*?\\d{4} - .*? - (.*?) - (.*?)$", "\\1", getwd()),
  "Link to File/Folder" = gsub(".*?(Research_development/.*?)", "\\1", getwd()),
  "Approx Time Needed?" = NA, 
  Requestor = "Jake"
)



DT::datatable(drs_info, 
							extensions = "Buttons",
							rownames = F, 
							options = list(dom = 'B',
														 scrollX = TRUE,
														 buttons = list(list(extend = 'copy', title = NULL, 
														 										header = FALSE))) )




```









\
\
\
\
\


# Notes


\
\
\
\
\




# Analysis 

## 1: Setup, Import, and Clean 
```{r setup}
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE, results = "asis")
options(kableExtra.auto_format = FALSE) #for proper table formating in Word
suppressMessages(library(tidyverse))
suppressMessages(library(tidylog))
suppressMessages(library(data.table))
suppressMessages(library(DT))






```


\


```{r import and clean}


#import


#standardize variable names



#standardize ID strings
standardize_ids = function(x){
	res = dplyr::case_when(
		nchar(x) == 4 ~ paste0("000", x),
		nchar(x) == 5 ~ paste0("00", x),
		nchar(x) == 6 ~ paste0("0", x),
		TRUE ~ x
		)
	res
}





```


\
\
\
\


## 2: Calculations  
```{r calculations}


```




\
\
\
\
\
\


# Results  

```{r results}

```






\
\
\
\
\
\



# 

# Session Information
<style>
.footer {
  position: relative;
  left: 0;
  bottom: 0;
  width: 100%;
}
</style>

<div class="footer">

```{r session info}

pander::pander(sessionInfo())

```

</div>
